<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>個人倉庫記錄</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 0 12px;
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
    }
    form {
      border: 1px solid #ccc;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
    }
    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 6px 8px;
      box-sizing: border-box;
      margin-top: 4px;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    button {
      padding: 6px 12px;
      margin-top: 8px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      text-align: left;
      font-size: 14px;
    }
    th {
      background: #f5f5f5;
    }
    tr:nth-child(even) {
      background: #fafafa;
    }
    .warning {
      color: #b00020;
      font-weight: 600;
    }
    .warning-row {
      background: #ffe6e6 !important;
    }
    .actions button {
      font-size: 12px;
      margin-right: 4px;
    }
    .small {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
    #statusGroup {
      margin-top: 4px;
    }
    #statusGroup label {
      display: inline-block;
      margin-right: 8px;
    }
    .inline-group {
      margin-top: 4px;
    }
    .inline-group label {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 4px;
    }
    #locationSummary {
      margin-top: 4px;
      margin-bottom: 4px;
      font-size: 14px;
      color: #333;
    }
  </style>
</head>
<body>
  <h1>個人倉庫記錄</h1>

  <form id="itemForm">
    <label>
      物品名稱（必填）
      <input type="text" id="nameInput" required />
    </label>

    <label>
      入庫日期（必填）
      <input type="date" id="dateInput" required />
    </label>

    <label>
      備註（選填）
      <textarea id="noteInput" placeholder="例如：放在書房櫃子上層、數量 3 個"></textarea>
    </label>

    <div>
      物品狀況（可多選）
      <div id="statusGroup">
        <label><input type="checkbox" value="技術部" /> 技術部</label>
        <label><input type="checkbox" value="機修" /> 機修</label>
        <label><input type="checkbox" value="電器" /> 電器</label>
        <label><input type="checkbox" value="車身" /> 車身</label>
      </div>
    </div>

    <div>
      地點（直接點選一個）
      <div id="locationGroup" class="inline-group">
        <label><input type="radio" name="location" value="場" /> 場</label>
        <label><input type="radio" name="location" value="走" /> 走</label>
        <label><input type="radio" name="location" value="外判" /> 外判</label>
      </div>
    </div>

    <div>
      種類（直接點選一個）
      <div id="typeGroup" class="inline-group">
        <label><input type="radio" name="type" value="垃圾車" /> 垃圾車</label>
        <label><input type="radio" name="type" value="巴士仔" /> 巴士仔</label>
        <label><input type="radio" name="type" value="TGE" /> TGE</label>
      </div>
    </div>

    <div>
      部門（直接點選一個）
      <div id="departmentGroup" class="inline-group">
        <label><input type="radio" name="department" value="機電" /> 機電</label>
        <label><input type="radio" name="department" value="食環" /> 食環</label>
        <label><input type="radio" name="department" value="懲教" /> 懲教</label>
        <label><input type="radio" name="department" value="海關" /> 海關</label>
        <label><input type="radio" name="department" value="警察" /> 警察</label>
        <label><input type="radio" name="department" value="消防" /> 消防</label>
      </div>
    </div>

    <button type="submit">新增記錄</button>
    <div class="small">資料會自動存到本機瀏覽器（localStorage），不會上傳網路。</div>
  </form>

  <h2>目前記錄</h2>
  <div id="locationSummary">場: 0 件　走: 0 件　外判: 0 件　總數: 0 件</div>

  <table>
    <thead>
      <tr>
        <th>物品名稱</th>
        <th>種類</th>
        <th>地點</th>
        <th>部門</th>
        <th>入庫日期</th>
        <th>已入庫天數</th>
        <th>提醒</th>
        <th>物品狀況</th>
        <th>備註</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="itemTableBody"></tbody>
  </table>

  <script>
    const STORAGE_KEY = "personal_warehouse_items";

    function loadItems() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.error("資料格式錯誤", e);
        return [];
      }
    }

    function saveItems(items) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    }

    function calcDaysDiff(fromDateStr) {
      const today = new Date();
      const fromDate = new Date(fromDateStr + "T00:00:00");
      const diffMs = today - fromDate;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      return diffDays;
    }

    function renderTable() {
      const tbody = document.getElementById("itemTableBody");
      const items = loadItems();
      tbody.innerHTML = "";

      const counts = { "場": 0, "走": 0, "外判": 0 };
      items.forEach(item => {
        if (item.location && counts.hasOwnProperty(item.location)) {
          counts[item.location] += 1;
        }
      });
      const total = items.length;
      const summaryEl = document.getElementById("locationSummary");
      if (summaryEl) {
        summaryEl.textContent =
          "場: " + counts["場"] + " 件　走: " + counts["走"] + " 件　外判: " + counts["外判"] + " 件　總數: " + total + " 件";
      }

      items.forEach((item, index) => {
        const tr = document.createElement("tr");

        const days = calcDaysDiff(item.date);
        const isOverTenDays = days > 10;

        if (isOverTenDays) {
          tr.classList.add("warning-row");
        }

        const nameTd = document.createElement("td");
        nameTd.textContent = item.name;

        const typeTd = document.createElement("td");
        typeTd.textContent = item.type || "";

        const locationTd = document.createElement("td");
        locationTd.textContent = item.location || "";

        const departmentTd = document.createElement("td");
        departmentTd.textContent = item.department || "";

        const dateTd = document.createElement("td");
        dateTd.textContent = item.date;

        const daysTd = document.createElement("td");
        daysTd.textContent = days + " 天";

        const warnTd = document.createElement("td");
        if (isOverTenDays) {
          warnTd.textContent = "已超過 10 天";
          warnTd.classList.add("warning");
        } else {
          warnTd.textContent = "尚未超過 10 天";
        }

        const statusTd = document.createElement("td");
        const statusText = Array.isArray(item.status) ? item.status.join("、") : "";
        statusTd.textContent = statusText;

        const noteTd = document.createElement("td");
        noteTd.textContent = item.note || "";

        const actionsTd = document.createElement("td");
        actionsTd.className = "actions";

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "刪除";
        deleteBtn.onclick = () => {
          if (confirm("確定要刪除這筆記錄嗎？")) {
            const current = loadItems();
            current.splice(index, 1);
            saveItems(current);
            renderTable();
          }
        };

        const editBtn = document.createElement("button");
        editBtn.textContent = "編輯";
        editBtn.onclick = () => {
          const current = loadItems();
          const target = current[index];

          const newName = prompt("修改物品名稱：", target.name);
          if (newName === null) return;

          const newDate = prompt("修改入庫日期（YYYY-MM-DD）：", target.date);
          if (newDate === null) return;

          const newNote = prompt("修改備註：", target.note || "");
          if (newNote === null) return;

          const newLocation = prompt("修改地點（場/走/外判）：", target.location || "");
          if (newLocation === null) return;

          const newType = prompt("修改種類（垃圾車/巴士仔/TGE）：", target.type || "");
          if (newType === null) return;

          const newDepartment = prompt("修改部門（機電/食環/懲教/海關/警察/消防）：", target.department || "");
          if (newDepartment === null) return;

          target.name = newName.trim();
          target.date = newDate.trim();
          target.note = newNote.trim();
          target.location = newLocation.trim();
          target.type = newType.trim();
          target.department = newDepartment.trim();

          saveItems(current);
          renderTable();
        };

        actionsTd.appendChild(editBtn);
        actionsTd.appendChild(deleteBtn);

        tr.appendChild(nameTd);
        tr.appendChild(typeTd);
        tr.appendChild(locationTd);
        tr.appendChild(departmentTd);
        tr.appendChild(dateTd);
        tr.appendChild(daysTd);
        tr.appendChild(warnTd);
        tr.appendChild(statusTd);
        tr.appendChild(noteTd);
        tr.appendChild(actionsTd);

        tbody.appendChild(tr);
      });
    }

    document.getElementById("itemForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const nameInput = document.getElementById("nameInput");
      const dateInput = document.getElementById("dateInput");
      const noteInput = document.getElementById("noteInput");
      const statusCheckboxes = document.querySelectorAll('#statusGroup input[type="checkbox"]:checked');
      const locationRadio = document.querySelector('input[name="location"]:checked');
      const typeRadio = document.querySelector('input[name="type"]:checked');
      const departmentRadio = document.querySelector('input[name="department"]:checked');

      const name = nameInput.value.trim();
      const date = dateInput.value;
      const note = noteInput.value.trim();
      const status = Array.from(statusCheckboxes).map(cb => cb.value);
      const location = locationRadio ? locationRadio.value : "";
      const type = typeRadio ? typeRadio.value : "";
      const department = departmentRadio ? departmentRadio.value : "";

      if (!name || !date || !location || !type || !department) {
        alert("請輸入物品名稱、入庫日期，並選擇地點、種類與部門");
        return;
      }

      const items = loadItems();
      items.push({ name, date, note, status, location, type, department });
      saveItems(items);

      nameInput.value = "";
      dateInput.value = "";
      noteInput.value = "";
      document.querySelectorAll('#statusGroup input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      document.querySelectorAll('#locationGroup input[type="radio"]').forEach(r => r.checked = false);
      document.querySelectorAll('#typeGroup input[type="radio"]').forEach(r => r.checked = false);
      document.querySelectorAll('#departmentGroup input[type="radio"]').forEach(r => r.checked = false);

      renderTable();
    });

    document.addEventListener("DOMContentLoaded", () => {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      document.getElementById("dateInput").value = `${yyyy}-${mm}-${dd}`;

      renderTable();
    });
  </script>
</body>
</html>