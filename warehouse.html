<!doctype html>
<html lang="zh-HK">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>個人記錄倉庫</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Noto Sans TC","Microsoft JhengHei",sans-serif;background:#f6f7f9;color:#222}
.container{max-width:1100px;margin:24px auto;padding:0 16px}
h1{font-size:24px;margin:0 0 12px}
h2{font-size:18px;margin:24px 0 8px}
.toolbar{display:flex;align-items:flex-end;gap:24px;flex-wrap:wrap;margin-bottom:8px}
.search{display:flex;gap:8px}
input[type="text"],input[type="date"]{padding:8px;border:1px solid #ccd3db;border-radius:6px;background:#fff;min-width:240px}
button{padding:8px 12px;border:1px solid #ccd3db;border-radius:6px;background:#fff;cursor:pointer}
button:hover{background:#f0f2f5}
.group-label{font-size:12px;color:#555;margin-bottom:4px}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #ccd3db;border-radius:999px;background:#fff;color:#333;cursor:pointer}
.chip.selected{background:#2563eb;color:#fff;border-color:#2563eb}
.chip.secondary{background:#eef2ff;border-color:#c7d2fe}
.count{display:inline-block;min-width:22px;padding:2px 6px;border-radius:999px;background:#e5e7eb;color:#333;font-size:12px}
.chip.selected .count{background:#1e3a8a;color:#fff}
.form-section,.alerts,.list-section{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
.form-row{display:flex;align-items:center;gap:12px;margin:10px 0}
.form-row label{width:110px}
.form-actions{display:flex;gap:10px;margin-top:8px}
.overdue-summary{display:flex;flex-direction:column;gap:6px}
.overdue-badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#fee2e2;color:#7f1d1d;border:1px solid #fca5a5;font-size:12px}
.list{width:100%;border-collapse:collapse}
.list th,.list td{border-bottom:1px solid #eee;padding:8px;text-align:left;vertical-align:top}
.list thead th{background:#f9fafb}
.status-pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid}
.status-ok{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
.status-overdue{background:#fee2e2;color:#7f1d1d;border-color:#fecaca}
.list-info{font-size:12px;color:#555;margin-bottom:8px}
.toolbar .location-filter{flex:1}
</style>
</head>
<body>
<div class="container">
  <h1>個人記錄倉庫</h1>
  <section class="toolbar">
    <div class="search">
      <input id="searchInput" type="text" placeholder="以物品名稱搜尋">
      <button id="clearSearch">清除</button>
    </div>
    <div class="location-filter">
      <div class="group-label">地點篩選</div>
      <div class="chips" id="locationFilter">
        <button class="chip" data-value="場">場<span class="count" data-count="場">0</span></button>
        <button class="chip" data-value="走">走<span class="count" data-count="走">0</span></button>
        <button class="chip" data-value="外判">外判<span class="count" data-count="外判">0</span></button>
        <button class="chip secondary" data-value="">全部</button>
      </div>
      <div class="filter-summary" id="filterSummary"></div>
    </div>
  </section>

  <section class="form-section">
    <h2>新增記錄</h2>
    <form id="recordForm">
      <div class="form-row">
        <label>物品名稱</label>
        <input id="nameInput" type="text" required placeholder="輸入物品名稱">
      </div>
      <div class="form-row">
        <label>入庫日期</label>
        <input id="dateInput" type="date" required>
      </div>
      <div class="form-row">
        <label>JOB NO. (可選)</label>
        <input id="jobInput" type="text" placeholder="可留空">
      </div>
      <div class="form-row">
        <label>物品狀況 (可多選)</label>
        <div class="chips multi" id="conditionChips"></div>
      </div>
      <div class="form-row">
        <label>地點</label>
        <div class="chips single" id="locationChips"></div>
      </div>
      <div class="form-row">
        <label>種類</label>
        <div class="chips single" id="typeChips"></div>
      </div>
      <div class="form-row">
        <label>部門</label>
        <div class="chips single" id="departmentChips"></div>
      </div>
      <div class="form-row">
        <label>車身</label>
        <div class="chips single" id="bodyChips"></div>
      </div>
      <div class="form-row">
        <label>來源 (可選)</label>
        <div class="chips single optional" id="sourceChips"></div>
      </div>
      <div class="form-row">
        <label>型號</label>
        <div class="chips single" id="modelChips"></div>
      </div>
      <div class="form-row">
        <label>保養</label>
        <div class="chips single" id="maintenanceChips"></div>
      </div>
      <div class="form-actions">
        <button type="submit">新增</button>
        <button type="reset" id="resetForm">重設</button>
      </div>
    </form>
  </section>

  <section class="alerts">
    <h2>逾期提醒</h2>
    <div id="overdueSummary" class="overdue-summary"></div>
  </section>

  <section class="list-section">
    <h2>目前紀錄</h2>
    <div id="listInfo" class="list-info"></div>
    <table class="list" id="recordsTable">
      <thead>
        <tr>
          <th>物品名稱</th>
          <th>入庫日期</th>
          <th>地點</th>
          <th>種類</th>
          <th>部門</th>
          <th>狀況</th>
          <th>車身</th>
          <th>來源</th>
          <th>型號</th>
          <th>保養</th>
          <th>JOB</th>
          <th>狀態</th>
        </tr>
      </thead>
      <tbody id="recordsBody"></tbody>
    </table>
  </section>
</div>
<script>
const OPTIONS={
  condition:['技術部','機修','電器','車身','等零件','等外判'],
  location:['場','走','外判'],
  type:['垃圾車(大)','垃圾車(細)','巴士仔','TGE','其他'],
  department:['機電','食環','懲教','海關','警察','消防'],
  body:['MAN','新力','其他'],
  source:['九龍灣','大埔','威菲','南昌','屯門','葵涌','東涌','其他'],
  model:['TG2','TG3','其他'],
  maintenance:['MAN','報價']
};

const STORAGE_KEY='recordApp.records';

function loadRecords(){
  const raw=localStorage.getItem(STORAGE_KEY);
  if(!raw) return [];
  try{ return JSON.parse(raw)||[] }catch(e){ return [] }
}

function saveRecords(list){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(list));
}

function todayISO(){
  const d=new Date();
  d.setHours(0,0,0,0);
  return d.toISOString().split('T')[0];
}

function parseISO(s){
  const parts=s.split('-').map(Number);
  return new Date(parts[0],parts[1]-1,parts[2]);
}

function daysBetween(a,b){
  const ms=Math.abs(a.getTime()-b.getTime());
  return Math.floor(ms/86400000);
}

function isOverdue(rec){
  const d=parseISO(rec.entryDate);
  const t=new Date(); t.setHours(0,0,0,0);
  return daysBetween(d,t)>10;
}

const state={
  records:loadRecords(),
  filters:{ search:'', location:'' }
};

function renderChips(containerId, items, mode){
  const el=document.getElementById(containerId);
  el.innerHTML='';
  items.forEach(v=>{
    const b=document.createElement('button');
    b.className='chip';
    b.textContent=v;
    b.dataset.value=v;
    b.addEventListener('click',()=>{
      if(mode==='multi'){
        b.classList.toggle('selected');
      }else{
        [...el.querySelectorAll('.chip')].forEach(x=>x.classList.remove('selected'));
        if(!b.classList.contains('selected')) b.classList.add('selected');
        else b.classList.remove('selected');
      }
    });
    el.appendChild(b);
  });
  if(mode==='single' && el.classList.contains('optional')){
    const none=document.createElement('button');
    none.className='chip secondary';
    none.textContent='不選';
    none.dataset.value='';
    none.addEventListener('click',()=>{
      [...el.querySelectorAll('.chip')].forEach(x=>x.classList.remove('selected'));
    });
    el.appendChild(none);
  }
}

function getSelectedValues(containerId, mode){
  const el=document.getElementById(containerId);
  const selected=[...el.querySelectorAll('.chip.selected')].map(x=>x.dataset.value);
  if(mode==='multi') return selected;
  return selected[0]||'';
}

function setupForm(){
  renderChips('conditionChips',OPTIONS.condition,'multi');
  renderChips('locationChips',OPTIONS.location,'single');
  renderChips('typeChips',OPTIONS.type,'single');
  renderChips('departmentChips',OPTIONS.department,'single');
  renderChips('bodyChips',OPTIONS.body,'single');
  renderChips('sourceChips',OPTIONS.source,'single');
  document.getElementById('sourceChips').classList.add('optional');
  renderChips('modelChips',OPTIONS.model,'single');
  renderChips('maintenanceChips',OPTIONS.maintenance,'single');

  const dateInput=document.getElementById('dateInput');
  dateInput.value=todayISO();

  const form=document.getElementById('recordForm');
  form.addEventListener('submit',e=>{
    e.preventDefault();
    const name=document.getElementById('nameInput').value.trim();
    const entryDate=document.getElementById('dateInput').value;
    const job=document.getElementById('jobInput').value.trim();
    const condition=getSelectedValues('conditionChips','multi');
    const location=getSelectedValues('locationChips','single');
    const type=getSelectedValues('typeChips','single');
    const department=getSelectedValues('departmentChips','single');
    const body=getSelectedValues('bodyChips','single');
    const source=getSelectedValues('sourceChips','single');
    const model=getSelectedValues('modelChips','single');
    const maintenance=getSelectedValues('maintenanceChips','single');
    if(!name||!entryDate||!location||!type||!department||!body||!model||!maintenance){
      alert('請完成必填選項');
      return;
    }
    const rec={
      id:Date.now(),
      name,
      entryDate,
      jobNo:job,
      condition,
      location,
      type,
      department,
      body,
      source,
      model,
      maintenance
    };
    state.records.push(rec);
    saveRecords(state.records);
    form.reset();
    document.getElementById('dateInput').value=todayISO();
    renderCounts();
    renderOverdue();
    renderList();
  });

  document.getElementById('resetForm').addEventListener('click',()=>{
    document.getElementById('dateInput').value=todayISO();
    ['conditionChips','locationChips','typeChips','departmentChips','bodyChips','sourceChips','modelChips','maintenanceChips']
      .forEach(id=>[...document.getElementById(id).querySelectorAll('.chip')].forEach(x=>x.classList.remove('selected')));
  });
}

function renderCounts(){
  const counts={};
  OPTIONS.location.forEach(l=>counts[l]=0);
  state.records.forEach(r=>{ if(counts[r.location]!=null) counts[r.location]++ });
  const lf=document.getElementById('locationFilter');
  ['場','走','外判'].forEach(l=>{
    const btn=[...lf.querySelectorAll('.chip')].find(x=>x.dataset.value===l);
    const span=btn.querySelector(`[data-count="${l}"]`);
    if(span) span.textContent=counts[l]||0;
  });
}

function renderOverdue(){
  const list=state.records.filter(isOverdue);
  const box=document.getElementById('overdueSummary');
  box.innerHTML='';
  if(list.length===0){
    const d=document.createElement('div');
    d.textContent='沒有逾期項目';
    box.appendChild(d);
    return;
  }
  const t=new Date(); t.setHours(0,0,0,0);
  list.forEach(r=>{
    const d=parseISO(r.entryDate);
    const days=daysBetween(d,t);
    const item=document.createElement('div');
    item.innerHTML=`<span class="overdue-badge">逾期 ${days} 天</span> ${r.name}（${r.location}，${r.entryDate}）`;
    box.appendChild(item);
  });
}

function renderList(){
  const tbody=document.getElementById('recordsBody');
  tbody.innerHTML='';
  const search=state.filters.search.toLowerCase();
  const loc=state.filters.location;
  let list=state.records.filter(r=>r.name.toLowerCase().includes(search));
  if(loc) list=list.filter(r=>r.location===loc);
  list=list.slice();
  if(loc){
    list.sort((a,b)=>parseISO(a.entryDate)-parseISO(b.entryDate));
  }else{
    list.sort((a,b)=>parseISO(b.entryDate)-parseISO(a.entryDate));
  }
  list.forEach(r=>{
    const tr=document.createElement('tr');
    const cond=r.condition.join('、');
    const status=isOverdue(r)?'<span class="status-pill status-overdue">逾期</span>':'<span class="status-pill status-ok">正常</span>';
    tr.innerHTML=`
      <td>${r.name}</td>
      <td>${r.entryDate}</td>
      <td>${r.location}</td>
      <td>${r.type}</td>
      <td>${r.department}</td>
      <td>${cond}</td>
      <td>${r.body}</td>
      <td>${r.source||''}</td>
      <td>${r.model}</td>
      <td>${r.maintenance}</td>
      <td>${r.jobNo||''}</td>
      <td>${status}</td>
    `;
    tbody.appendChild(tr);
  });
  const info=document.getElementById('listInfo');
  if(loc){
    const total=list.length;
    const earliest=list[0]?list[0].entryDate:'—';
    info.textContent=`地點：${loc}｜總數：${total}｜最早日期：${earliest}`;
  }else{
    info.textContent=`全部記錄：${list.length}`;
  }
}

function setupSearch(){
  const input=document.getElementById('searchInput');
  const clear=document.getElementById('clearSearch');
  input.addEventListener('input',()=>{
    state.filters.search=input.value||'';
    renderList();
  });
  clear.addEventListener('click',()=>{
    input.value='';
    state.filters.search='';
    renderList();
  });
}

function setupLocationFilter(){
  const lf=document.getElementById('locationFilter');
  lf.querySelectorAll('.chip').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const val=btn.dataset.value;
      state.filters.location=val;
      lf.querySelectorAll('.chip').forEach(x=>x.classList.remove('selected'));
      if(val) btn.classList.add('selected');
      const summary=document.getElementById('filterSummary');
      if(val) summary.textContent=`已選地點：${val}`;
      else summary.textContent='';
      renderList();
    });
  });
}

function init(){
  setupForm();
  setupSearch();
  setupLocationFilter();
  renderCounts();
  renderOverdue();
  renderList();
}

document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>